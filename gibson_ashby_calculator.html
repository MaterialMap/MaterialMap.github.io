<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gibson-Ashby & Deshpande-Fleck Calculator for Foams</title>
    <link rel="stylesheet" href="unified-styles.css">
    <link rel="stylesheet" href="src/css/components/units.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        .input-error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 5px rgba(231, 76, 60, 0.3) !important;
        }
        .input-warning {
            border-color: #f39c12 !important;
            box-shadow: 0 0 5px rgba(243, 156, 18, 0.3) !important;
        }
    </style>

</head>
<body>
    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">Material MAP</a>
            <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="swift_law_calculator.html">Swift's Law Calculator</a></li>
                <li><a href="mooney_rivlin_calculator.html">Mooney-Rivlin Calculator</a></li>
                <li><a href="johnson_cook_calculator.html">Johnson-Cook Calculator</a></li>
                <li><a href="gibson_ashby_calculator.html">Gibson-Ashby Calculator</a></li>
                <li><a href="ceb_fip_calculator.html">CEB-FIP Calculator</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <h1>Gibson-Ashby & Deshpande-Fleck Models for Cellular Foams</h1>
        
        <!-- Disclaimer -->
        <div style="margin-bottom: 30px; padding: 20px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; border: 1px solid #ffeaa7;">
            <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 18px;">‚ö†Ô∏è Important Disclaimer</h3>
            <p style="margin: 0 0 10px 0; color: #856404; line-height: 1.6; font-size: 14px;">
                The Gibson-Ashby model describes the three-stage compression behavior of cellular foams: elastic, plateau, and densification. The Deshpande-Fleck extension adds isotropic hardening to the plateau region, where the slope is controlled by hardening coefficient H.
            </p>
            <p style="margin: 0 0 10px 0; color: #856404; line-height: 1.6; font-size: 14px;">
                <strong>References:</strong> Gibson, L.J., Ashby, M.F., "Cellular Solids: Structure and Properties", 2nd edition, Cambridge University Press, 1997. Deshpande, V.S., Fleck, N.A., "Isotropic constitutive models for metallic foams", Journal of the Mechanics and Physics of Solids, 2000.
            </p>
            <p style="margin: 0; color: #856404; line-height: 1.6; font-size: 14px; font-weight: 600;">
                <strong>Note:</strong> This interactive calculator shows typical foam behavior patterns. Use experimentally determined parameters for design calculations.
            </p>
        </div>

        <!-- Formula Information -->
        <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
            <h2 style="margin: 0; color: #2c3e50; font-size: 24px;">Gibson-Ashby & Deshpande-Fleck Models</h2>
            <div style="font-size: 22px; font-weight: bold; margin: 15px 0; color: #2c3e50; font-family: 'Times New Roman', serif;">
                E*/Es = C‚ÇÅ(œÅ*/œÅs)¬≤
            </div>
            <div style="font-size: 22px; font-weight: bold; margin: 15px 0; color: #2c3e50; font-family: 'Times New Roman', serif;">
                œÉ*/œÉs = C‚ÇÉ(œÅ*/œÅs)^1.5
            </div>
            <div style="font-size: 20px; font-weight: bold; margin: 15px 0; color: #e74c3c; font-family: 'Times New Roman', serif;">
                œÉ(Œµ) = œÉ<sub>pl</sub>[1 + H(Œµ - Œµ<sub>y</sub>)]
            </div>
            <div style="font-size: 14px; color: #7f8c8d; line-height: 1.5;">
                <strong>where:</strong> E* - foam elastic modulus, Es - solid elastic modulus, œÉ* - foam plateau stress, œÉs - solid yield strength, œÅ*/œÅs - relative density, C‚ÇÅ, C‚ÇÉ - material constants<br>
                <strong>Deshpande-Fleck:</strong> H - hardening coefficient (0 = pure plateau, >0 = hardening slope)
            </div>
        </div>
        
        <!-- Units Panel -->
        <div class="units-panel">
            <h3>
                <span>üîß Units Settings</span>
                <button class="units-toggle" onclick="toggleUnitsPanel()">Show/Hide</button>
            </h3>
            <div id="unitsSettings" class="units-grid" style="display: none;">
                <div class="unit-group">
                    <label>Pressure/Stress Units:</label>
                    <select id="pressureUnit" onchange="updateUnits()">
                        <option value="MPa" selected>Megapascal (MPa)</option>
                        <option value="Pa">Pascal (Pa)</option>
                        <option value="kPa">Kilopascal (kPa)</option>
                        <option value="GPa">Gigapascal (GPa)</option>
                        <option value="psi">Pounds per square inch (psi)</option>
                    </select>
                </div>
                <div class="unit-group">
                    <label>Density Units:</label>
                    <select id="densityUnit" onchange="updateUnits()">
                        <option value="kg/m¬≥" selected>kg/m¬≥</option>
                        <option value="g/cm¬≥">g/cm¬≥</option>
                        <option value="lb/ft¬≥">lb/ft¬≥</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Input Parameters -->
        <div class="inputs">
            <div class="input-item with-units">
                <label for="foamType">Foam Type:</label>
                <select id="foamType" onchange="scheduleCalculation()">
                    <option value="eps">EPS (Expanded Polystyrene)</option>
                    <option value="epp">EPP (Expanded Polypropylene)</option>
                    <option value="pu">PU (Polyurethane)</option>
                </select>
            </div>
            <div class="input-item with-units">
                <label for="density">Foam Density:</label>
                <div class="input-with-units">
                    <input type="number" id="density" step="0.1" value="25" min="10" max="200" oninput="scheduleCalculation()" onblur="validateDensity()">
                    <span class="unit-display" id="densityUnitDisplay">kg/m¬≥</span>
                </div>
            </div>
            <div class="input-item with-units">
                <label for="hardeningCoeff">Hardening Coefficient, H:</label>
                <div class="input-with-units">
                    <input type="number" id="hardeningCoeff" step="0.01" value="0" min="0" max="10" oninput="scheduleCalculation()" onblur="validateHardeningCoeff()">
                    <span class="unit-display">-</span>
                </div>
            </div>
        </div>

        <!-- Output Results -->
        <div class="results" id="results" style="display: none;">
            <div class="result-item">
                <div class="result-name">Elastic Modulus, E*</div>
                <div class="result-value with-units">
                    <span id="elasticModulus">-</span>
                    <span class="result-unit" id="elasticModulusUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Plateau Stress, œÉ*</div>
                <div class="result-value with-units">
                    <span id="plateauStress">-</span>
                    <span class="result-unit" id="plateauStressUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Densification Strain, Œµd</div>
                <div class="result-value with-units">
                    <span id="densificationStrain">60.0</span>
                    <span class="result-unit">%</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Energy Absorption, W</div>
                <div class="result-value with-units">
                    <span id="energyAbsorption">-</span>
                    <span class="result-unit" id="energyAbsorptionUnit">MJ/m¬≥</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Interactive Chart Section -->
    <div class="container" id="chartContainer" style="display: none;">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Interactive Gibson-Ashby & Deshpande-Fleck Compression Curve</h2>
        <div class="collapsible-content collapsed">
            <div class="chart-container">
                <div id="chartSvg" style="width: 100%; height: 600px;">
                    <!-- Chart will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table Section -->
    <div class="container" id="tableContainer" style="display: none;">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Gibson-Ashby Curve Data Points</h2>
        <div class="collapsible-content collapsed">
            <div class="table-header">
                <div></div>
                <button class="export-btn" onclick="exportToCSV()">üìä Export CSV</button>
            </div>
            <div class="table-container">
                <table id="propertiesTable">
                    <thead>
                        <tr>
                            <th>Strain, Œµ [%]</th>
                            <th>Stress, œÉ [MPa]</th>
                            <th>Stage</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
    <script src="src/js/utils/UnitsHandler.js"></script>
    <script src="src/js/utils/PlotlyChartManager.js"></script>
    <script src="navigation.js"></script>
    <script>
        let chartManager = new PlotlyChartManager();
        let calculationTimeout;
        window.unitsHandler = new UnitsHandler();
        
        // Initialize units handler when page loads
        window.addEventListener('load', async function() {
            const initialized = await unitsHandler.initialize();
            if (!initialized) {
                console.warn('Units handler initialization failed, using fallback');
            } else {
                console.log('Units handler initialized successfully');
            }
        });
        
        const foamProperties = {
            eps: { 
                name: 'EPS (Expanded Polystyrene)', 
                C1: 0.6, 
                C3: 0.25, 
                Es: 3000, // MPa
                sigmaS: 50, // MPa 
                rhoS: 1050, // kg/m3
                color: '#3498db' 
            },
            epp: { 
                name: 'EPP (Expanded Polypropylene)', 
                C1: 0.8, 
                C3: 0.3, 
                Es: 1200, // MPa
                sigmaS: 35, // MPa
                rhoS: 900, // kg/m3
                color: '#e74c3c' 
            },
            pu: { 
                name: 'PU (Polyurethane)', 
                C1: 0.4, 
                C3: 0.2, 
                Es: 2000, // MPa
                sigmaS: 40, // MPa
                rhoS: 1200, // kg/m3
                color: '#2ecc71' 
            }
        };

        // Unit conversion factors
        const unitConversions = {
            pressure: {
                'Pa': 1e-6,
                'kPa': 1e-3,
                'MPa': 1,
                'GPa': 1e3,
                'psi': 6.89476e-3
            },
            density: {
                'kg/m¬≥': 1,
                'g/cm¬≥': 1000,
                'lb/ft¬≥': 16.0185
            }
        };

        function scheduleCalculation() {
            clearTimeout(calculationTimeout);
            calculationTimeout = setTimeout(calculate, 100);
        }

        function validateDensity() {
            const input = document.getElementById('density');
            let value = parseFloat(input.value);
            
            // Remove any existing error classes
            input.classList.remove('input-error', 'input-warning');
            
            if (isNaN(value) || value < 10) {
                input.classList.add('input-error');
                setTimeout(() => {
                    input.value = 10;
                    input.classList.remove('input-error');
                    scheduleCalculation();
                }, 1000);
            } else if (value > 200) {
                input.classList.add('input-error');
                setTimeout(() => {
                    input.value = 200;
                    input.classList.remove('input-error');
                    scheduleCalculation();
                }, 1000);
            }
        }

        function validateHardeningCoeff() {
            const input = document.getElementById('hardeningCoeff');
            let value = parseFloat(input.value);
            
            // Remove any existing error classes
            input.classList.remove('input-error', 'input-warning');
            
            if (isNaN(value) || value < 0) {
                input.classList.add('input-error');
                setTimeout(() => {
                    input.value = 0;
                    input.classList.remove('input-error');
                    scheduleCalculation();
                }, 1000);
            } else if (value > 10) {
                input.classList.add('input-error');
                setTimeout(() => {
                    input.value = 10;
                    input.classList.remove('input-error');
                    scheduleCalculation();
                }, 1000);
            }
        }

        function calculate() {
            // Get and validate input values
            let density = parseFloat(document.getElementById('density').value);
            let hardeningCoeff = parseFloat(document.getElementById('hardeningCoeff').value);
            const foamType = document.getElementById('foamType').value;
            const densityUnit = document.getElementById('densityUnit').value;
            const pressureUnit = document.getElementById('pressureUnit').value;
            
            // Convert density to base unit (kg/m¬≥) for calculations
            let densityInKgM3 = density;
            if (densityUnit === 'g/cm¬≥') {
                densityInKgM3 = density * 1000;
            } else if (densityUnit === 'lb/ft¬≥') {
                densityInKgM3 = density * 16.0185;
            }
            
            // Validate inputs (but don't modify the input fields)
            if (isNaN(densityInKgM3) || densityInKgM3 < 10) densityInKgM3 = 10;
            if (densityInKgM3 > 200) densityInKgM3 = 200;
            if (isNaN(hardeningCoeff) || hardeningCoeff < 0) hardeningCoeff = 0;
            if (hardeningCoeff > 10) hardeningCoeff = 10;
            
            const props = foamProperties[foamType];
            const relDensity = densityInKgM3 / props.rhoS;
            
            // Gibson-Ashby model parameters (calculated in MPa)
            const E_foam_MPa = props.C1 * props.Es * Math.pow(relDensity, 2); // MPa
            const sigma_pl_MPa = props.C3 * props.sigmaS * Math.pow(relDensity, 1.5); // MPa
            const energyAbsorption_MJ = sigma_pl_MPa * 60 / 100; // MJ/m¬≥
            
            // Convert results to display units
            const E_foam = convertPressure(E_foam_MPa, 'MPa', pressureUnit);
            const sigma_pl = convertPressure(sigma_pl_MPa, 'MPa', pressureUnit);
            const energyAbsorption = convertPressure(energyAbsorption_MJ, 'MPa', pressureUnit);
            
            // Update results display
            document.getElementById('elasticModulus').textContent = E_foam.toFixed(E_foam >= 1000 ? 0 : E_foam >= 100 ? 1 : E_foam >= 10 ? 2 : 3);
            document.getElementById('plateauStress').textContent = sigma_pl.toFixed(sigma_pl >= 100 ? 1 : sigma_pl >= 10 ? 2 : 3);
            document.getElementById('energyAbsorption').textContent = energyAbsorption.toFixed(energyAbsorption >= 100 ? 1 : energyAbsorption >= 10 ? 2 : 3);
            
            // Show results
            document.getElementById('results').style.display = 'grid';
            document.getElementById('chartContainer').style.display = 'block';
            document.getElementById('tableContainer').style.display = 'block';
            
            // Update chart (use original density input and kg/m¬≥ values for calculations)
            updateChart(densityInKgM3, foamType, hardeningCoeff);
            
            // Update data table
            generateDataTable(densityInKgM3, foamType, hardeningCoeff);
        }
        
        // Helper function to convert pressure units
        function convertPressure(value, fromUnit, toUnit) {
            if (fromUnit === toUnit) return value;
            
            // Try using UnitsHandler first if available
            if (unitsHandler && unitsHandler.initialized) {
                try {
                    const quantity = unitsHandler.createQuantity(value, fromUnit);
                    if (quantity) {
                        const converted = unitsHandler.convert(quantity, toUnit);
                        if (converted) {
                            return unitsHandler.getValue(converted);
                        }
                    }
                } catch (error) {
                    console.warn('UnitsHandler conversion failed, using fallback:', error);
                }
            }
            
            // Fallback to simple conversion
            // Convert to Pa first (base unit)
            let valueInPa = value;
            switch(fromUnit) {
                case 'Pa': valueInPa = value; break;
                case 'kPa': valueInPa = value * 1000; break;
                case 'MPa': valueInPa = value * 1000000; break;
                case 'GPa': valueInPa = value * 1000000000; break;
                case 'psi': valueInPa = value * 6894.76; break;
            }
            
            // Convert from Pa to target unit
            switch(toUnit) {
                case 'Pa': return valueInPa;
                case 'kPa': return valueInPa / 1000;
                case 'MPa': return valueInPa / 1000000;
                case 'GPa': return valueInPa / 1000000000;
                case 'psi': return valueInPa / 6894.76;
                default: return valueInPa / 1000000; // Default to MPa
            }
        }

        function updateChart(density, foamType, hardeningCoeff) {
            if (!chartManager.isPlotlyLoaded()) {
                console.warn('Plotly.js not loaded, skipping chart update');
                return;
            }

            const props = foamProperties[foamType];
            const relDensity = density / props.rhoS;
            
            const E_foam = props.C1 * props.Es * Math.pow(relDensity, 2);
            const sigma_pl = props.C3 * props.sigmaS * Math.pow(relDensity, 1.5);
            
            const parameters = {
                E_foam: E_foam,
                sigma_pl: sigma_pl,
                E_densification: sigma_pl * 5,
                hardeningCoeff: hardeningCoeff
            };
            
            const options = {
                maxStrain: 0.8,
                stressUnit: 'MPa',
                title: `${props.name} - Density: ${density} kg/m¬≥, H: ${hardeningCoeff}`
            };

            try {
                chartManager.createGibsonAshbyChart('chartSvg', parameters, options)
                    .catch(error => {
                        console.error('Error creating Gibson-Ashby chart:', error);
                    });
            } catch (error) {
                console.error('Chart update error:', error);
            }
        }

        function generateDataTable(density, foamType, hardeningCoeff) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            const props = foamProperties[foamType];
            const relDensity = density / props.rhoS;
            
            const E = props.C1 * props.Es * Math.pow(relDensity, 2);
            const sigmaPl = props.C3 * props.sigmaS * Math.pow(relDensity, 1.5);
            const epsilonD = 60;
            const epsilonY = (100 * sigmaPl) / E;
            
            // Generate data points
            let strainPoints = [];
            for (let i = 0; i <= 99; i++) {
                strainPoints.push(i);
            }
            
            if (epsilonY % 1 !== 0 && epsilonY >= 0 && epsilonY <= 99) {
                strainPoints.push(epsilonY);
            }
            if (epsilonD % 1 !== 0 && epsilonD >= 0 && epsilonD <= 99) {
                strainPoints.push(epsilonD);
            }
            
            strainPoints.sort((a, b) => a - b);
            
            strainPoints.forEach(epsilon => {
                let sigma, stage, description;
                
                if (epsilon <= epsilonY) {
                    sigma = E * (epsilon / 100);
                    stage = 'I';
                    description = 'Elastic';
                } else if (epsilon <= epsilonD) {
                    const strainIncrement = (epsilon - epsilonY) / 100;
                    sigma = sigmaPl * (1 + hardeningCoeff * strainIncrement);
                    stage = 'II';
                    description = hardeningCoeff > 0 ? 'Plateau (Hardening)' : 'Plateau';
                } else {
                    const plateauStressAtDensification = sigmaPl * (1 + hardeningCoeff * (epsilonD - epsilonY) / 100);
                    const epsilonRel = (epsilon - epsilonD) / (100 - epsilonD);
                    sigma = plateauStressAtDensification * (1 + 5 * Math.pow(epsilonRel, 2));
                    stage = 'III';
                    description = 'Densification';
                }
                
                const row = tableBody.insertRow();
                const isTransition = (Math.abs(epsilon - epsilonY) < 0.001) || (Math.abs(epsilon - epsilonD) < 0.001);
                
                if (isTransition) {
                    row.style.backgroundColor = '#fff3cd';
                    row.style.fontWeight = 'bold';
                }
                
                row.insertCell(0).textContent = epsilon.toFixed(epsilon % 1 === 0 ? 0 : 2);
                row.insertCell(1).textContent = sigma.toFixed(4);
                row.insertCell(2).textContent = stage;
                row.insertCell(3).textContent = description + (isTransition ? ' (Transition)' : '');
            });
        }

        function toggleUnitsPanel() {
            const panel = document.getElementById('unitsSettings');
            panel.style.display = panel.style.display === 'none' ? 'grid' : 'none';
        }

        function updateUnits() {
            console.log('updateUnits called');
            
            // Store old units
            const oldPressureUnit = document.getElementById('elasticModulusUnit').textContent;
            const oldDensityUnit = document.getElementById('densityUnitDisplay').textContent;
            
            // Get new units
            const pressureUnit = document.getElementById('pressureUnit').value;
            const densityUnit = document.getElementById('densityUnit').value;
            
            console.log(`Units changing: pressure ${oldPressureUnit} -> ${pressureUnit}, density ${oldDensityUnit} -> ${densityUnit}`);
            
            // Convert density if units changed
            if (oldDensityUnit !== densityUnit) {
                const densityInput = document.getElementById('density');
                const currentDensity = parseFloat(densityInput.value);
                
                if (!isNaN(currentDensity)) {
                    let convertedDensity = currentDensity;
                    
                    // Try using UnitsHandler first if available
                    if (unitsHandler && unitsHandler.initialized) {
                        try {
                            const quantity = unitsHandler.createQuantity(currentDensity, oldDensityUnit);
                            if (quantity) {
                                const converted = unitsHandler.convert(quantity, densityUnit);
                                if (converted) {
                                    convertedDensity = unitsHandler.getValue(converted);
                                    console.log(`Converting density using UnitsHandler: ${currentDensity} ${oldDensityUnit} -> ${convertedDensity.toFixed(3)} ${densityUnit}`);
                                    densityInput.value = convertedDensity.toFixed(convertedDensity < 1 ? 3 : 2);
                                    return;
                                }
                            }
                        } catch (error) {
                            console.warn('UnitsHandler density conversion failed, using fallback:', error);
                        }
                    }
                    
                    // Fallback to simple conversion
                    // Convert from old unit to kg/m¬≥ (base unit)
                    if (oldDensityUnit === 'g/cm¬≥') {
                        convertedDensity = currentDensity * 1000;
                    } else if (oldDensityUnit === 'lb/ft¬≥') {
                        convertedDensity = currentDensity * 16.0185;
                    }
                    // kg/m¬≥ is base unit, no conversion needed
                    
                    // Convert from kg/m¬≥ (base unit) to new unit
                    if (densityUnit === 'g/cm¬≥') {
                        convertedDensity = convertedDensity / 1000;
                    } else if (densityUnit === 'lb/ft¬≥') {
                        convertedDensity = convertedDensity / 16.0185;
                    }
                    // kg/m¬≥ is base unit, no conversion needed
                    
                    console.log(`Converting density using fallback: ${currentDensity} ${oldDensityUnit} -> ${convertedDensity.toFixed(2)} ${densityUnit}`);
                    densityInput.value = convertedDensity.toFixed(convertedDensity < 1 ? 3 : 2);
                }
            }
            
            // Update unit displays
            document.getElementById('densityUnitDisplay').textContent = densityUnit;
            document.getElementById('elasticModulusUnit').textContent = pressureUnit;
            document.getElementById('plateauStressUnit').textContent = pressureUnit;
            document.getElementById('energyAbsorptionUnit').textContent = pressureUnit === 'MPa' ? 'MJ/m¬≥' : 'J/m¬≥';
            
            // Recalculate with new units
            scheduleCalculation();
        }

        function toggleCollapse(header) {
            const content = header.nextElementSibling;
            const isCollapsed = header.classList.contains('collapsed');
            
            if (isCollapsed) {
                header.classList.remove('collapsed');
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
            } else {
                header.classList.add('collapsed');
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
            }
        }

        function exportToCSV() {
            const table = document.getElementById('propertiesTable');
            let csv = [];
            
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
            csv.push(headers.join(','));
            
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            rows.forEach(row => {
                const cells = Array.from(row.cells).map(cell => cell.textContent);
                csv.push(cells.join(','));
            });
            
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gibson_ashby_deshpande_fleck_data.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            scheduleCalculation();
        });
    </script>
    
    <!-- Navigation Script -->
    <script type="module" src="src/js/navigation-only.js"></script>
</body>
</html>