<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-P Mooney-Rivlin vs. Shore Hardness Calculator</title>
    <link rel="stylesheet" href="unified-styles.css">
    <link rel="stylesheet" href="src/css/components/units.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">Material MAP</a>
            <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="swift_law_calculator.html">Swift's Law Calculator</a></li>
                <li><a href="mooney_rivlin_calculator.html">Mooney-Rivlin Calculator</a></li>
                <li><a href="johnson_cook_calculator.html">Johnson-Cook Calculator</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <h1>2-P Mooney-Rivlin vs. Shore Hardness Calculator</h1>
        
        <!-- Disclaimer -->
        <div style="margin-bottom: 30px; padding: 20px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; border: 1px solid #ffeaa7;">
            <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 18px;">‚ö†Ô∏è Important Disclaimer</h3>
            <p style="margin: 0 0 10px 0; color: #856404; line-height: 1.6; font-size: 14px;">
                This is an approximate methodology published in: Altidis, P. A.; Warner, B. V., 2005, "Analyzing hyperelastic materials w/some practical considerations." Midwest ANSYS Users Group. The correlations provide rough estimates and should be validated against experimental data for critical applications.
            </p>
            <p style="margin: 0; color: #856404; line-height: 1.6; font-size: 14px; font-weight: 600;">
                <strong>Valid Range:</strong> Shore Hardness from 35¬∞ to 70¬∞ only. Results outside this range are not reliable.
            </p>
        </div>
        
        <!-- Formula Information -->
        <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
            <h2 style="margin: 0; color: #2c3e50; font-size: 24px;">Mooney-Rivlin Material Model</h2>
            <div style="font-size: 20px; font-weight: bold; margin: 15px 0; color: #2c3e50; font-family: 'Times New Roman', serif;">
                W = C‚ÇÅ‚ÇÄ(I‚ÇÅ - 3) + C‚ÇÄ‚ÇÅ(I‚ÇÇ - 3)
            </div>
            <div style="font-size: 14px; color: #7f8c8d; line-height: 1.5;">
                <strong>where:</strong> W - strain energy density function, C‚ÇÅ‚ÇÄ and C‚ÇÄ‚ÇÅ - Mooney-Rivlin constants, I‚ÇÅ and I‚ÇÇ - strain invariants
            </div>
        </div>

        <!-- Units Panel -->
        <div class="units-panel">
            <h3>
                <span>üîß Units Settings</span>
                <button class="units-toggle" onclick="toggleUnitsPanel()">Show/Hide</button>
            </h3>
            <div id="unitsSettings" class="units-grid" style="display: none;">
                <div class="unit-group">
                    <label>Pressure/Modulus Units:</label>
                    <select id="pressureUnit" onchange="updateUnits()">
                        <option value="MPa" selected>Megapascal (MPa)</option>
                        <option value="Pa">Pascal (Pa)</option>
                        <option value="kPa">Kilopascal (kPa)</option>
                        <option value="GPa">Gigapascal (GPa)</option>
                        <option value="psi">Pounds per square inch (psi)</option>
                    </select>
                </div>
                <div class="unit-group">
                    <label>Hardness Units:</label>
                    <select id="hardnessUnit" onchange="updateUnits()">
                        <option value="Shore A" selected>Shore A (¬∞)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="input-group" style="grid-template-columns: 1fr; max-width: 400px; margin: 0 auto;">
            <div class="input-item with-units">
                <label for="shoreHardness">Shore Hardness, A (35-70):</label>
                <div class="input-with-units">
                    <input type="number" id="shoreHardness" min="35" max="70" value="50" step="0.1" oninput="updateFromInput()">
                    <span class="unit-display" id="shoreHardnessUnit">¬∞</span>
                </div>
            </div>
        </div>

        <div class="results" id="results" style="display: grid;">
            <div class="result-item">
                <div class="result-name">Young's Modulus, E</div>
                <div class="result-value with-units">
                    <span id="youngModulus">-</span>
                    <span class="result-unit" id="youngModulusUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Shear Modulus, G</div>
                <div class="result-value with-units">
                    <span id="shearModulus">-</span>
                    <span class="result-unit" id="shearModulusUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Mooney-Rivlin Constant, C‚ÇÅ‚ÇÄ</div>
                <div class="result-value with-units">
                    <span id="c10">-</span>
                    <span class="result-unit" id="c10Unit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Mooney-Rivlin Constant, C‚ÇÄ‚ÇÅ</div>
                <div class="result-value with-units">
                    <span id="c01">-</span>
                    <span class="result-unit" id="c01Unit">MPa</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="chartContainer">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Interactive Curves</h2>
        <div class="collapsible-content collapsed">
            <div class="chart-container">
                <svg id="mooneyRivlinChart" viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
                    <!-- Chart will be generated here -->
                </svg>
            </div>
        </div>
    </div>

    <div class="container" id="tableContainer">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Data Table</h2>
        <div class="collapsible-content collapsed">
            <div class="table-header">
                <div></div>
                <button class="export-btn" onclick="exportToCSV()">üìä Export CSV</button>
            </div>
            <div class="table-container">
                <table id="parametersTable">
                    <thead>
                        <tr>
                            <th>Shore Hardness, A [¬∞]</th>
                            <th>Young's Modulus, E [MPa]</th>
                            <th>Shear Modulus, G [MPa]</th>
                            <th>Mooney-Rivlin Constant, C‚ÇÅ‚ÇÄ [MPa]</th>
                            <th>Mooney-Rivlin Constant, C‚ÇÄ‚ÇÅ [MPa]</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="navigation.js"></script>
    <script src="src/js/utils/UnitsHandler.js"></script>
    <script>
        let currentShoreHardness = 50;
        let unitsHandler = new UnitsHandler();
        let currentUnits = {
            pressure: 'MPa'
        };

        // Initialize units handler when page loads
        window.addEventListener('load', async function() {
            const initialized = await unitsHandler.initialize();
            if (!initialized) {
                console.warn('Units handler initialization failed, using fallback');
            }
            updateUnitDisplays();
            calculate(); // Initial calculation
        });

        function toggleUnitsPanel() {
            const panel = document.getElementById('unitsSettings');
            panel.style.display = panel.style.display === 'none' ? 'grid' : 'none';
        }

        function updateUnits() {
            currentUnits.pressure = document.getElementById('pressureUnit').value;
            updateUnitDisplays();
            calculate();
        }

        function updateUnitDisplays() {
            // Update result unit displays
            document.getElementById('youngModulusUnit').textContent = currentUnits.pressure;
            document.getElementById('shearModulusUnit').textContent = currentUnits.pressure;
            document.getElementById('c10Unit').textContent = currentUnits.pressure;
            document.getElementById('c01Unit').textContent = currentUnits.pressure;
        }

        function convertToDisplayUnits(value, quantityType) {
            if (!unitsHandler.initialized) {
                return value; // Fallback to raw value
            }

            const baseUnit = unitsHandler.getPrimaryUnit(quantityType);
            const displayUnit = currentUnits[quantityType];
            
            const quantity = unitsHandler.createQuantity(value, baseUnit);
            if (!quantity) return value;

            const converted = unitsHandler.convert(quantity, displayUnit);
            return converted ? unitsHandler.getValue(converted) : value;
        }

        function updateFromInput() {
            const inputValue = document.getElementById('shoreHardness').value;
            if (inputValue >= 35 && inputValue <= 70) {
                currentShoreHardness = parseFloat(inputValue);
                calculate();
            }
        }

        function formatScientific(value, decimals = 3) {
            if (Math.abs(value) < 0.001 || Math.abs(value) >= 1000) {
                return value.toExponential(decimals);
            }
            return value.toFixed(decimals);
        }

        function calculate() {
            const x = currentShoreHardness;
            
            // Calculate parameters using the given formulas (results in MPa - base units)
            const youngModulusBase = 1.5048e-1 * Math.exp(5.5579e-2 * x);
            const shearModulusBase = 7.5401e-2 * Math.exp(4.5779e-2 * x);
            const c10Base = 3.0338e-2 * Math.exp(4.5684e-2 * x);
            const c01Base = 7.5554e-3 * Math.exp(4.5749e-2 * x);

            // Convert to display units
            const youngModulus = convertToDisplayUnits(youngModulusBase, 'pressure');
            const shearModulus = convertToDisplayUnits(shearModulusBase, 'pressure');
            const c10 = convertToDisplayUnits(c10Base, 'pressure');
            const c01 = convertToDisplayUnits(c01Base, 'pressure');

            // Display results
            document.getElementById('youngModulus').textContent = formatScientific(youngModulus);
            document.getElementById('shearModulus').textContent = formatScientific(shearModulus);
            document.getElementById('c10').textContent = formatScientific(c10);
            document.getElementById('c01').textContent = formatScientific(c01);

            // Update chart
            updateChart();
        }

        function drawChart() {
            const svg = document.getElementById('mooneyRivlinChart');
            svg.innerHTML = '';

            // Chart dimensions
            const margin = { top: 40, right: 80, bottom: 60, left: 80 };
            const width = 900 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            // Create main group
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', `translate(${margin.left},${margin.top})`);
            svg.appendChild(g);

            // Add background
            const background = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            background.setAttribute('width', width);
            background.setAttribute('height', height);
            background.setAttribute('fill', '#f8f9fa');
            background.setAttribute('stroke', '#dee2e6');
            g.appendChild(background);

            // Generate data points for curves
            const dataPoints = [];
            for (let shore = 35; shore <= 70; shore += 0.5) {
                dataPoints.push({
                    shore: shore,
                    youngModulus: 1.5048e-1 * Math.exp(5.5579e-2 * shore),
                    shearModulus: 7.5401e-2 * Math.exp(4.5779e-2 * shore),
                    c10: 3.0338e-2 * Math.exp(4.5684e-2 * shore),
                    c01: 7.5554e-3 * Math.exp(4.5749e-2 * shore)
                });
            }

            // Find min and max values for Y axis
            const allYValues = dataPoints.flatMap(d => [d.youngModulus, d.shearModulus, d.c10, d.c01]);
            const yMin = Math.min(...allYValues);
            const yMax = Math.max(...allYValues);

            // Scales
            const xScale = (value) => (value - 35) / (70 - 35) * width;
            const yScale = (value) => height - (Math.log(value) - Math.log(yMin)) / (Math.log(yMax) - Math.log(yMin)) * height;

            // Draw axes
            drawAxes(g, width, height, xScale, yScale, yMin, yMax);

            // Draw curves
            const curves = [
                { data: 'youngModulus', color: '#2563eb', name: "Young's Modulus" },
                { data: 'shearModulus', color: '#dc2626', name: 'Shear Modulus' },
                { data: 'c10', color: '#16a34a', name: 'C‚ÇÅ‚ÇÄ' },
                { data: 'c01', color: '#ca8a04', name: 'C‚ÇÄ‚ÇÅ' }
            ];

            curves.forEach(curve => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                let pathData = '';
                dataPoints.forEach((point, i) => {
                    const x = xScale(point.shore);
                    const y = yScale(point[curve.data]);
                    pathData += (i === 0 ? 'M' : 'L') + x + ',' + y;
                });
                path.setAttribute('d', pathData);
                path.setAttribute('stroke', curve.color);
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                g.appendChild(path);
            });

            // Add current point markers
            addCurrentMarkers(g, xScale, yScale);
        }

        function drawAxes(g, width, height, xScale, yScale, yMin, yMax) {
            // X axis
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', 0);
            xAxis.setAttribute('y1', height);
            xAxis.setAttribute('x2', width);
            xAxis.setAttribute('y2', height);
            xAxis.setAttribute('stroke', '#333');
            xAxis.setAttribute('stroke-width', '1');
            g.appendChild(xAxis);

            // Y axis
            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', 0);
            yAxis.setAttribute('y1', 0);
            yAxis.setAttribute('x2', 0);
            yAxis.setAttribute('y2', height);
            yAxis.setAttribute('stroke', '#333');
            yAxis.setAttribute('stroke-width', '1');
            g.appendChild(yAxis);

            // X axis labels
            for (let shore = 35; shore <= 70; shore += 5) {
                const x = xScale(shore);
                
                // Tick mark
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', x);
                tick.setAttribute('y1', height);
                tick.setAttribute('x2', x);
                tick.setAttribute('y2', height + 5);
                tick.setAttribute('stroke', '#333');
                g.appendChild(tick);
                
                // Label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', height + 20);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '10');
                label.setAttribute('fill', '#333');
                label.textContent = shore;
                g.appendChild(label);
            }

            // Y axis labels (logarithmic scale)
            const logYMin = Math.log(yMin);
            const logYMax = Math.log(yMax);
            const logRange = logYMax - logYMin;
            
            for (let i = 0; i <= 5; i++) {
                const logValue = logYMin + (i / 5) * logRange;
                const value = Math.exp(logValue);
                const y = yScale(value);
                
                // Tick mark
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', -5);
                tick.setAttribute('y1', y);
                tick.setAttribute('x2', 0);
                tick.setAttribute('y2', y);
                tick.setAttribute('stroke', '#333');
                g.appendChild(tick);
                
                // Label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', -10);
                label.setAttribute('y', y + 3);
                label.setAttribute('text-anchor', 'end');
                label.setAttribute('font-size', '10');
                label.setAttribute('fill', '#333');
                label.textContent = formatScientific(value, 1);
                g.appendChild(label);
            }

            // Axis titles
            const xTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xTitle.setAttribute('x', width / 2);
            xTitle.setAttribute('y', height + 50);
            xTitle.setAttribute('text-anchor', 'middle');
            xTitle.setAttribute('font-size', '12');
            xTitle.setAttribute('font-weight', 'bold');
            xTitle.setAttribute('fill', '#333');
            xTitle.textContent = 'Shore Hardness A [¬∞]';
            g.appendChild(xTitle);

            const yTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yTitle.setAttribute('x', -60);
            yTitle.setAttribute('y', height / 2);
            yTitle.setAttribute('text-anchor', 'middle');
            yTitle.setAttribute('font-size', '12');
            yTitle.setAttribute('font-weight', 'bold');
            yTitle.setAttribute('fill', '#333');
            yTitle.setAttribute('transform', `rotate(-90, -60, ${height / 2})`);
            yTitle.textContent = 'Parameters [MPa]';
            g.appendChild(yTitle);
        }

        function addCurrentMarkers(g, xScale, yScale) {
            const currentValues = {
                youngModulus: 1.5048e-1 * Math.exp(5.5579e-2 * currentShoreHardness),
                shearModulus: 7.5401e-2 * Math.exp(4.5779e-2 * currentShoreHardness),
                c10: 3.0338e-2 * Math.exp(4.5684e-2 * currentShoreHardness),
                c01: 7.5554e-3 * Math.exp(4.5749e-2 * currentShoreHardness)
            };

            const colors = ['#2563eb', '#dc2626', '#16a34a', '#ca8a04'];
            const values = [currentValues.youngModulus, currentValues.shearModulus, currentValues.c10, currentValues.c01];
            
            values.forEach((value, i) => {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                marker.setAttribute('cx', xScale(currentShoreHardness));
                marker.setAttribute('cy', yScale(value));
                marker.setAttribute('r', '4');
                marker.setAttribute('fill', colors[i]);
                marker.setAttribute('stroke', '#fff');
                marker.setAttribute('stroke-width', '2');
                g.appendChild(marker);
            });
        }

        function updateChart() {
            drawChart();
        }

        function generateTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            for (let shore = 35; shore <= 70; shore++) {
                const youngModulus = 1.5048e-1 * Math.exp(5.5579e-2 * shore);
                const shearModulus = 7.5401e-2 * Math.exp(4.5779e-2 * shore);
                const c10 = 3.0338e-2 * Math.exp(4.5684e-2 * shore);
                const c01 = 7.5554e-3 * Math.exp(4.5749e-2 * shore);

                const row = tableBody.insertRow();
                row.insertCell(0).textContent = shore;
                row.insertCell(1).textContent = formatScientific(youngModulus);
                row.insertCell(2).textContent = formatScientific(shearModulus);
                row.insertCell(3).textContent = formatScientific(c10);
                row.insertCell(4).textContent = formatScientific(c01);
            }
        }

        function exportToCSV() {
            let csvContent = "Shore Hardness A [¬∞],Young's Modulus E [MPa],Shear Modulus G [MPa],C10 [MPa],C01 [MPa]\n";
            
            for (let shore = 35; shore <= 70; shore++) {
                const youngModulus = 1.5048e-1 * Math.exp(5.5579e-2 * shore);
                const shearModulus = 7.5401e-2 * Math.exp(4.5779e-2 * shore);
                const c10 = 3.0338e-2 * Math.exp(4.5684e-2 * shore);
                const c01 = 7.5554e-3 * Math.exp(4.5749e-2 * shore);
                
                csvContent += `${shore},${youngModulus.toExponential(6)},${shearModulus.toExponential(6)},${c10.toExponential(6)},${c01.toExponential(6)}\n`;
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'mooney_rivlin_data.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function toggleCollapse(element) {
            const content = element.nextElementSibling;
            const isCollapsed = element.classList.contains('collapsed');
            
            if (isCollapsed) {
                element.classList.remove('collapsed');
                content.classList.remove('collapsed');
            } else {
                element.classList.add('collapsed');
                content.classList.add('collapsed');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            calculate();
            drawChart();
            generateTable();
        });
    </script>

    <style>
        /* Additional styles for the calculator */
        .collapsible-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 30px;
        }

        .collapsible-header:before {
            content: '‚ñº';
            position: absolute;
            right: 0;
            top: 0;
            transition: transform 0.3s ease;
        }

        .collapsible-header.collapsed:before {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            display: none;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
            
            .chart-container svg {
                width: 100%;
                height: auto;
            }
        }
    </style>
</body>
</html>