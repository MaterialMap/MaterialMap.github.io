<!doctype html>
<html lang="en">
<head>
    <title>Submit Material - Material MAP</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <style>
        .form-container {
            max-width: 850px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 778px; /* Точная ширина для 90 символов: 756px текст + 20px padding + 2px border */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace; /* Одинаковый моноширинный шрифт для всех */
            font-size: 14px; /* Одинаковый размер шрифта */
            box-sizing: border-box;
        }
        
        .form-group textarea {
            min-height: 120px;
        }
        
        /* Specific heights for different textarea fields */
        #material-data {
            height: 315px; /* 15 lines × 21px line-height */
            min-height: 315px;
        }
        
        #eos-data,
        #mat-add-data,
        #mat-thermal-data {
            height: 315px; /* 15 lines × 21px line-height */
            min-height: 315px;
        }
        
        #applications {
            height: 105px; /* 5 lines × 21px line-height */
            min-height: 105px;
        }
        
        #reference {
            height: 84px; /* 4 lines × 21px line-height */
            min-height: 84px;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .submit-btn {
            background-color: #4169E1;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .submit-btn:hover {
            background-color: #27408B;
        }
        
        .preview-btn {
            background-color: #6c757d;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .preview-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: none;
        }
        
        .help-text {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        #toml-preview {
            text-align: left;
            white-space: pre;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        /* Responsive design for mobile devices */
        @media (max-width: 768px) {
            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Submit New Material</h1>
        
        <div class="form-container">
            <form id="material-form">
                <div class="form-group">
                    <label for="material-data">Material Data <span class="required">*</span></label>
                    <textarea id="material-data" name="materialData" required
                              placeholder="*MAT_ELASTIC_TITLE&#10;Material Name Here&#10;$ Author, A. (Year). Title of the paper/source&#10;$ Additional source information or comments&#10;$--------1---------2---------3---------4---------5---------6---------7---------8&#10;$#     MID        RO         E        PR        DA        DB  NOT USED        &#10;         1   7.85e-6    200000      0.29       0.0       0.0         0&#10;$--------1---------2---------3---------4---------5---------6---------7---------8"></textarea>
                    <div class="help-text">Complete LS-DYNA material card with title, comments, and parameters. Material ID and name are automatically extracted from this field.</div>
                </div>

                <div class="form-group">
                    <label for="applications">Applications <span class="required">*</span></label>
                    <textarea id="applications" name="applications" required
                              placeholder="Primary material name&#10;Application area 1&#10;Application area 2&#10;Use case description"></textarea>
                    <div class="help-text">List of material types, applications, or use cases (one per line)</div>
                </div>

                <div class="form-group">
                    <label for="reference-url">Source URL <span class="required">*</span></label>
                    <input type="url" id="reference-url" name="referenceUrl" required
                           placeholder="https://example.com/source-link">
                    <div class="help-text">Direct link to the original source, paper, or reference</div>
                </div>

                <div class="form-group">
                    <label for="eos-data">Equation of State Data (Optional)</label>
                    <textarea id="eos-data" name="eosData"
                              placeholder="*EOS_GRUNEISEN_TITLE&#10;EOS Name Here&#10;$ Author, A. (Year). Title of the paper/source&#10;$--------1---------2---------3---------4---------5---------6---------7---------8&#10;$#   EOSID         C         S     GAMMA         A        E0        V0&#10;         1      4569      1.49      2.17       0.0       0.0       1.0&#10;$--------1---------2---------3---------4---------5---------6---------7---------8"></textarea>
                    <div class="help-text">EOS model definition when material requires EOS model. EOS ID and name are automatically extracted from this field.</div>
                </div>

                <div class="form-group">
                    <label for="mat-add-data">Additional Material Data (Optional)</label>
                    <textarea id="mat-add-data" name="matAddData"
                              placeholder="*MAT_ADD_EROSION_TITLE&#10;Erosion criteria&#10;$ Author, A. (Year). Title of the paper/source&#10;$--------1---------2---------3---------4---------5---------6---------7---------8&#10;$#   ADDID    MXPRES    MNPRES      SIGP     SIGVM    MXEPS1    MXEPS2    MXEPS3&#10;         1       0.0      -1.0       0.0       0.0       0.3       0.0       0.0&#10;$#  MXEPS4    MXEPS5    MXEPS6    MXEPS7    MXEPS8    NUMFIP    MNEPS1    MNEPS2&#10;       0.0       0.0       0.0       0.0       0.0         0       0.0       0.0&#10;$#  MNEPS3    MNEPS4    MNEPS5    MNEPS6    MNEPS7    MNEPS8   IMPULSE    FAILTM&#10;       0.0       0.0       0.0       0.0       0.0       0.0       0.0       0.0&#10;$--------1---------2---------3---------4---------5---------6---------7---------8"></textarea>
                    <div class="help-text">MAT_ADD definitions (erosion, damage, etc.). MAT_ADD ID and name are automatically extracted from this field.</div>
                </div>

                <div class="form-group">
                    <label for="mat-thermal-data">Thermal Material Data (Optional)</label>
                    <textarea id="mat-thermal-data" name="matThermalData"
                              placeholder="*MAT_THERMAL_ISOTROPIC_TITLE&#10;Thermal properties&#10;$ Author, A. (Year). Title of the paper/source&#10;$--------1---------2---------3---------4---------5---------6---------7---------8&#10;$#    TMID        RO        TG      TGRL        HC&#10;         1   7.85e-6      20.0       0.0     460.0&#10;$--------1---------2---------3---------4---------5---------6---------7---------8"></textarea>
                    <div class="help-text">Thermal properties and models. Thermal ID and name are automatically extracted from this field.</div>
                </div>

                <div class="form-group">
                    <label for="reference">Full Citation Reference (Optional)</label>
                    <textarea id="reference" name="reference"
                              placeholder="Author, A., & Co-Author, B. (Year). Title of the Paper or Book. Journal Name, Volume(Issue), Page-Range. DOI: 10.xxxx/xxxxx"></textarea>
                    <div class="help-text">Complete bibliographic reference to the source</div>
                </div>

                <div class="form-group">
                    <button type="button" class="preview-btn" onclick="generatePreview()">
                        Preview TOML
                    </button>
                    <button type="submit" class="submit-btn">
                        Submit via GitHub
                    </button>
                </div>
            </form>

            <div id="preview" class="preview-container">
                <h3>Generated TOML Preview:</h3>
                <pre id="toml-preview"></pre>
            </div>
        </div>

        <div class="about-link">
            <p><a href="index.html">← Back to Materials Database</a></p>
        </div>
    </div>

    <script>
        function generatePreview() {
            const formData = new FormData(document.getElementById('material-form'));
            const data = Object.fromEntries(formData);
            
            // Validate required fields
            const required = ['materialData', 'applications', 'referenceUrl'];
            const missing = required.filter(field => !data[field] || data[field].trim() === '');
            
            if (missing.length > 0) {
                alert(`Please fill in all required fields: ${missing.join(', ')}`);
                return;
            }
            
            // Generate TOML content
            const applications = data.applications.split('\n')
                .map(app => app.trim())
                .filter(app => app.length > 0);
            
            let toml = `# TOML file generated from Material MAP submission form\n\n`;
            toml += `[[material]]\n`;
            toml += `# REQUIRED FIELDS\n\n`;
            
            // Material data (required)
            toml += `# Material model definition (REQUIRED)\n`;
            toml += `mat_data = """\n`;
            toml += data.materialData;
            if (!data.materialData.endsWith('\n')) {
                toml += '\n';
            }
            toml += `"""\n\n`;
            
            // Applications (required)
            toml += `# Applications list (REQUIRED)\n`;
            toml += `app = [\n`;
            applications.forEach(app => {
                toml += `  "${app.replace(/"/g, '\\"')}",\n`;
            });
            toml += `]\n\n`;
            
            // Source URL (required)
            toml += `# Source URL (REQUIRED)\n`;
            toml += `url = "${data.referenceUrl}"\n\n`;
            
            // Optional fields
            let hasOptionalFields = false;
            
            // EOS data (optional)
            if (data.eosData && data.eosData.trim()) {
                if (!hasOptionalFields) {
                    toml += `# OPTIONAL FIELDS\n\n`;
                    hasOptionalFields = true;
                }
                toml += `# Equation of State definition (OPTIONAL)\n`;
                toml += `eos_data = """\n`;
                toml += data.eosData;
                if (!data.eosData.endsWith('\n')) {
                    toml += '\n';
                }
                toml += `"""\n\n`;
            }
            
            // MAT_ADD data (optional)
            if (data.matAddData && data.matAddData.trim()) {
                if (!hasOptionalFields) {
                    toml += `# OPTIONAL FIELDS\n\n`;
                    hasOptionalFields = true;
                }
                toml += `# Additional material model data (OPTIONAL)\n`;
                toml += `mat_add_data = """\n`;
                toml += data.matAddData;
                if (!data.matAddData.endsWith('\n')) {
                    toml += '\n';
                }
                toml += `"""\n\n`;
            }
            
            // Thermal data (optional)
            if (data.matThermalData && data.matThermalData.trim()) {
                if (!hasOptionalFields) {
                    toml += `# OPTIONAL FIELDS\n\n`;
                    hasOptionalFields = true;
                }
                toml += `# Thermal material model data (OPTIONAL)\n`;
                toml += `mat_thermal_data = """\n`;
                toml += data.matThermalData;
                if (!data.matThermalData.endsWith('\n')) {
                    toml += '\n';
                }
                toml += `"""\n\n`;
            }
            
            // Full citation reference (optional)
            if (data.reference && data.reference.trim()) {
                if (!hasOptionalFields) {
                    toml += `# OPTIONAL FIELDS\n\n`;
                    hasOptionalFields = true;
                }
                toml += `# Full citation reference (OPTIONAL)\n`;
                toml += `ref = "${data.reference.replace(/"/g, '\\"')}"\n\n`;
            }
            
            document.getElementById('toml-preview').textContent = toml;
            document.getElementById('preview').style.display = 'block';
        }
        
        function extractMaterialName(materialData) {
            // Extract material name from the second line of material data
            const lines = materialData.split('\n');
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line && !line.startsWith('*') && !line.startsWith('$')) {
                    return line;
                }
            }
            return 'Unknown Material';
        }
        
        document.getElementById('material-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Validate required fields
            const required = ['materialData', 'applications', 'referenceUrl'];
            const missing = required.filter(field => !data[field] || data[field].trim() === '');
            
            if (missing.length > 0) {
                alert(`Please fill in all required fields: ${missing.join(', ')}`);
                return;
            }
            
            // Extract material name from material data
            const materialName = extractMaterialName(data.materialData);
            
            // Generate GitHub Issue URL
            const title = `[MATERIAL] ${materialName}`;
            let body = `### Material Submission\n\n`;
            body += `**Material Name:** ${materialName}\n\n`;
            
            body += `### Material Data\n\`\`\`\n${data.materialData}\n\`\`\`\n\n`;
            
            body += `### Applications\n${data.applications}\n\n`;
            
            body += `### Source URL\n${data.referenceUrl}\n\n`;
            
            if (data.eosData && data.eosData.trim()) {
                body += `### EOS Data\n\`\`\`\n${data.eosData}\n\`\`\`\n\n`;
            }
            
            if (data.matAddData && data.matAddData.trim()) {
                body += `### Additional Material Data\n\`\`\`\n${data.matAddData}\n\`\`\`\n\n`;
            }
            
            if (data.matThermalData && data.matThermalData.trim()) {
                body += `### Thermal Material Data\n\`\`\`\n${data.matThermalData}\n\`\`\`\n\n`;
            }
            
            if (data.reference && data.reference.trim()) {
                body += `### Full Citation Reference\n${data.reference}\n\n`;
            }
            
            // Generate TOML preview for the issue
            generatePreview();
            const tomlContent = document.getElementById('toml-preview').textContent;
            body += `### Generated TOML\n\`\`\`toml\n${tomlContent}\n\`\`\`\n\n`;
            
            // Create GitHub Issue URL
            const issueUrl = `https://github.com/yurynovozhilov/MaterialMap/issues/new?` +
                `title=${encodeURIComponent(title)}&` +
                `body=${encodeURIComponent(body)}&` +
                `labels=material-submission`;
            
            // Open in new tab
            window.open(issueUrl, '_blank');
        });
    </script>
</body>
</html>