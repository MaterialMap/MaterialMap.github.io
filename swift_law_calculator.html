<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift's Law Calculator</title>
    <link rel="stylesheet" href="unified-styles.css">
    <link rel="stylesheet" href="src/css/components/units.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">Material MAP</a>
            <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="swift_law_calculator.html">Swift's Law Calculator</a></li>
                <li><a href="mooney_rivlin_calculator.html">Mooney-Rivlin Calculator</a></li>
                <li><a href="johnson_cook_calculator.html">Johnson-Cook Calculator</a></li>
                <li><a href="gibson_ashby_calculator.html">Gibson-Ashby Calculator</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <h1>Swift's Law Calculator for Metal Strain Hardening</h1>
        
        <!-- Disclaimer -->
        <div style="margin-bottom: 30px; padding: 20px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; border: 1px solid #ffeaa7;">
            <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 18px;">‚ö†Ô∏è Important Disclaimer</h3>
            <p style="margin: 0; color: #856404; line-height: 1.6; font-size: 14px;">
                This methodology does not improve calculation accuracy as it operates on very limited input data, which is insufficient for comprehensive nonlinear analysis. The methodology is designed to make the integration process numerically more stable by providing a smooth transition from elastic to plastic behavior.
            </p>
        </div>
        
        <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
            <h2 style="margin: 0; color: #2c3e50; font-size: 24px;">Swift's Law Formula</h2>
            <div style="font-size: 28px; font-weight: bold; margin: 15px 0; color: #2c3e50; font-family: 'Times New Roman', serif;">
                œÉ = K(Œµ‚ÇÄ + Œµ)‚Åø
            </div>
            <div style="font-size: 14px; color: #7f8c8d; line-height: 1.5;">
                <strong>where:</strong> œÉ - true stress, K - strength coefficient, Œµ‚ÇÄ - initial strain, Œµ - plastic strain, n - hardening exponent
            </div>
        </div>
        


        <!-- Units Panel -->
        <div class="units-panel">
            <h3>
                <span>üîß Units Settings</span>
                <button class="units-toggle" onclick="toggleUnitsPanel()">Show/Hide</button>
            </h3>
            <div id="unitsSettings" class="units-grid" style="display: none;">
                <div class="unit-group">
                    <label>Pressure/Stress Units:</label>
                    <select id="pressureUnit" onchange="updateUnits()">
                        <option value="MPa" selected>Megapascal (MPa)</option>
                        <option value="Pa">Pascal (Pa)</option>
                        <option value="kPa">Kilopascal (kPa)</option>
                        <option value="GPa">Gigapascal (GPa)</option>
                        <option value="psi">Pounds per square inch (psi)</option>
                    </select>
                </div>
                <div class="unit-group">
                    <label>Strain Units:</label>
                    <select id="strainUnit" onchange="updateUnits()">
                        <option value="" selected>Dimensionless (-)</option>
                        <option value="%">Percent (%)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="input-group">
            <div class="input-item with-units">
                <label for="youngModulus">Young's Modulus, E:</label>
                <div class="input-with-units">
                    <input type="number" id="youngModulus" step="any" value="200000" oninput="scheduleCalculation()">
                    <span class="unit-display" id="youngModulusUnit">MPa</span>
                </div>
            </div>
            <div class="input-item with-units">
                <label for="yieldStrength">Yield Strength, œÉ<sub>y</sub>:</label>
                <div class="input-with-units">
                    <input type="number" id="yieldStrength" step="any" value="349.1" oninput="scheduleCalculation()">
                    <span class="unit-display" id="yieldStrengthUnit">MPa</span>
                </div>
            </div>
            <div class="input-item with-units">
                <label for="tensileStrength">Ultimate Tensile Strength, œÉ<sub>u</sub>:</label>
                <div class="input-with-units">
                    <input type="number" id="tensileStrength" step="any" value="687.4" oninput="scheduleCalculation()">
                    <span class="unit-display" id="tensileStrengthUnit">MPa</span>
                </div>
            </div>
            <div class="input-item with-units">
                <label for="elongation">Elongation at Break, A:</label>
                <div class="input-with-units">
                    <input type="number" id="elongation" step="any" value="0.08" oninput="scheduleCalculation()">
                    <span class="unit-display" id="elongationUnit">-</span>
                </div>
            </div>
            <div class="input-item with-units">
                <label for="epsilon0">Residual Plastic Strain, Œµ‚ÇÄ:</label>
                <div class="input-with-units">
                    <input type="number" id="epsilon0" step="any" value="0" oninput="scheduleCalculation()">
                    <span class="unit-display" id="epsilon0Unit">-</span>
                </div>
            </div>
        </div>

        <div class="results" id="results" style="display: none;">
            <div class="result-item">
                <div class="result-name">Ultimate Tensile Strength (True), œÉ<sub>u,true</sub></div>
                <div class="result-value with-units">
                    <span id="trueTensileStrength">-</span>
                    <span class="result-unit" id="trueTensileStrengthUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Hardening Exponent, n</div>
                <div class="result-value with-units">
                    <span id="hardeningExponent">-</span>
                    <span class="result-unit">-</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Strength Coefficient, K</div>
                <div class="result-value with-units">
                    <span id="strengthCoefficient">-</span>
                    <span class="result-unit" id="strengthCoefficientUnit">MPa</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Residual Plastic Strain, Œµ<sub>0</sub></div>
                <div class="result-value with-units">
                    <span id="residualStrain">-</span>
                    <span class="result-unit" id="residualStrainUnit">-</span>
                </div>
            </div>
            <div class="result-item">
                <div class="result-name">Tangent Modulus, E<sub>tan</sub></div>
                <div class="result-value with-units">
                    <span id="tangentModulus">-</span>
                    <span class="result-unit" id="tangentModulusUnit">MPa</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="chartContainer" style="display: none;">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Stress-Strain Curve</h2>
        <div class="collapsible-content collapsed">
            <div class="chart-container">
                <div id="stressStrainChart" style="width: 100%; height: 500px;">
                    <!-- Chart will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="tableContainer" style="display: none;">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">Strain-Stress Data Table</h2>
        <div class="collapsible-content collapsed">
            <div class="table-header">
                <div></div>
                <button class="export-btn" onclick="exportToCSV()">üìä Export CSV</button>
            </div>
            <div class="table-container">
                <table id="strainTable">
                    <thead>
                        <tr>
                            <th>Total Strain, Œµ<sub>total</sub> [-]</th>
                            <th>Plastic Strain, Œµ<sub>plastic</sub> [-]</th>
                            <th>True Stress, œÉ [MPa]</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="container" id="curveContainer" style="display: none;">
        <h2 class="collapsible-header collapsed" onclick="toggleCollapse(this)">LS-DYNA *DEFINE_CURVE_STRESS</h2>
        <div class="collapsible-content collapsed">
            <div class="code-container">
                <div class="code-header">
                    <span class="code-title">*DEFINE_CURVE_STRESS</span>
                    <button class="copy-button" onclick="copyToClipboard()">Copy</button>
                </div>
                <pre id="defineCurveStress"></pre>
            </div>
        </div>
    </div>

    <script>
        let calculatedValues = {};
        let calculationTimeout = null;
        let chartManager = null;





        function scheduleCalculation() {
            if (calculationTimeout) {
                clearTimeout(calculationTimeout);
            }
            calculationTimeout = setTimeout(calculate, 300);
        }

        function formatScientific(value, decimals = 2) {
            if (Math.abs(value) < 0.001 || Math.abs(value) >= 10000) {
                return value.toExponential(decimals);
            }
            return value.toFixed(decimals);
        }

        function calculate() {
            try {
                // Get input data
                const E = parseFloat(document.getElementById('youngModulus').value);
                const sigma_y = parseFloat(document.getElementById('yieldStrength').value);
                const sigma_u = parseFloat(document.getElementById('tensileStrength').value);
                const A = parseFloat(document.getElementById('elongation').value);
                const epsilon_0 = parseFloat(document.getElementById('epsilon0').value);

                if (isNaN(E) || isNaN(sigma_y) || isNaN(sigma_u) || isNaN(A) || isNaN(epsilon_0)) {
                    hideResults();
                    return;
                }

                if (E <= 0 || sigma_y <= 0 || sigma_u <= 0 || A <= 0 || sigma_u <= sigma_y) {
                    hideResults();
                    return;
                }

                // Calculate output parameters
                const sigma_u_true = sigma_u * (1 + A);
                const elasticLimit = sigma_y / E;
                const plasticStrainAtBreak = A - elasticLimit;
                
                // Swift's law: œÉ = K(Œµ‚ÇÄ + Œµ_plastic)‚Åø
                let n, K;
                
                if (epsilon_0 === 0) {
                    // Traditional Swift's law: œÉ = K(Œµ_plastic)‚Åø
                    // Use the original calculation method when epsilon_0 = 0
                    n = Math.log(sigma_y / sigma_u_true) / Math.log(sigma_y / (E * Math.log(1 + A)));
                    K = Math.pow(E, n) * Math.pow(sigma_y, 1 - n);
                } else {
                    // Modified Swift's law with initial strain: œÉ = K(Œµ‚ÇÄ + Œµ_plastic)‚Åø
                    // At yield point: œÉ_y = K(Œµ‚ÇÄ)‚Åø  
                    // At ultimate point: œÉ_u_true = K(Œµ‚ÇÄ + Œµ_plastic_at_break)‚Åø
                    n = Math.log(sigma_u_true / sigma_y) / Math.log((epsilon_0 + plasticStrainAtBreak) / epsilon_0);
                    K = sigma_y / Math.pow(epsilon_0, n);
                }
                
                const eps_y = epsilon_0; // This is the input parameter now
                const E_tan = (sigma_u_true - sigma_y) / A;

                // Check for NaN in results
                if (isNaN(n) || isNaN(K) || isNaN(eps_y) || isNaN(E_tan)) {
                    hideResults();
                    return;
                }

                // Save calculated values
                calculatedValues = { E, sigma_y, sigma_u, A, epsilon_0, sigma_u_true, n, K, eps_y, E_tan };

                // Display results
                document.getElementById('trueTensileStrength').textContent = formatScientific(sigma_u_true);
                document.getElementById('hardeningExponent').textContent = formatScientific(n);
                document.getElementById('strengthCoefficient').textContent = formatScientific(K);
                document.getElementById('residualStrain').textContent = formatScientific(eps_y);
                document.getElementById('tangentModulus').textContent = formatScientific(E_tan);

                document.getElementById('results').style.display = 'grid';

                // Generate table, chart and curve definition
                generateTable();
                drawChart();
                generateDefineCurveStress();
                document.getElementById('tableContainer').style.display = 'block';
                document.getElementById('chartContainer').style.display = 'block';
                document.getElementById('curveContainer').style.display = 'block';

            } catch (error) {
                console.error('Calculation error:', error);
                hideResults();
            }
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('tableContainer').style.display = 'none';
            document.getElementById('chartContainer').style.display = 'none';
            document.getElementById('curveContainer').style.display = 'none';
        }

        function generateTable() {
            try {
                const { E, sigma_y, n, K, eps_y, A, epsilon_0 } = calculatedValues;
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';

                const maxStrain = A * 1.1;
                const steps = 50;
                const strainStep = maxStrain / steps;
                const elasticLimit = sigma_y / E;

                // Create array of strain values, ensuring yield point is included
                const strainValues = [];
                let yieldPointIncluded = false;
                
                for (let i = 0; i <= steps; i++) {
                    const totalStrain = i * strainStep;
                    
                    // If we haven't included yield point yet and current strain > elasticLimit
                    if (!yieldPointIncluded && totalStrain > elasticLimit) {
                        // Add yield point first
                        strainValues.push(elasticLimit);
                        yieldPointIncluded = true;
                    }
                    
                    strainValues.push(totalStrain);
                }

                // Generate table rows for all strain values
                strainValues.forEach(totalStrain => {
                    let plasticStrain, stress;

                    if (totalStrain <= elasticLimit) {
                        plasticStrain = 0;
                        stress = E * totalStrain;
                    } else {
                        plasticStrain = totalStrain - elasticLimit;
                        
                        if (epsilon_0 === 0) {
                            // Traditional Swift's law: œÉ = K(Œµ_plastic)‚Åø
                            const eps_y_calc = Math.pow(E / K, 1 / (n - 1));
                            stress = K * Math.pow(eps_y_calc + plasticStrain, n);
                        } else {
                            // Modified Swift's law: œÉ = K(Œµ‚ÇÄ + Œµ_plastic)‚Åø
                            stress = K * Math.pow(epsilon_0 + plasticStrain, n);
                        }
                    }

                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = formatScientific(totalStrain, 4);
                    row.insertCell(1).textContent = formatScientific(plasticStrain, 4);
                    row.insertCell(2).textContent = formatScientific(stress, 2);
                });
            } catch (error) {
                console.error('Table generation error:', error);
            }
        }

        function drawChart() {
            if (!chartManager) {
                console.warn('PlotlyChartManager not available, skipping chart update');
                return;
            }
            if (!chartManager.isPlotlyLoaded()) {
                console.warn('Plotly.js not loaded, skipping chart update');
                return;
            }

            try {
                const { E, sigma_y, n, K, eps_y, A, epsilon_0 } = calculatedValues;

                const maxStrain = A * 1.2;
                const elasticLimit = sigma_y / E;
                const steps = 200;

                // Generate data for elastic region (linear part)
                const elasticX = [];
                const elasticY = [];
                const elasticSteps = 20;
                for (let i = 0; i <= elasticSteps; i++) {
                    const totalStrain = (elasticLimit * i) / elasticSteps;
                    const stress = E * totalStrain;
                    elasticX.push(totalStrain);
                    elasticY.push(stress);
                }

                // Generate data for plastic region - Swift's Law
                const plasticX = [];
                const plasticY = [];
                const plasticStrainRange = A - elasticLimit;
                const strainStep = plasticStrainRange / steps;
                
                // Start from yield point to ensure continuity
                plasticX.push(elasticLimit);
                plasticY.push(sigma_y);
                
                for (let i = 1; i <= steps; i++) {
                    const totalStrain = elasticLimit + i * strainStep;
                    const plasticStrain = totalStrain - elasticLimit;
                    let stress;
                    
                    if (epsilon_0 === 0) {
                        const eps_y_calc = Math.pow(E / K, 1 / (n - 1));
                        stress = K * Math.pow(eps_y_calc + plasticStrain, n);
                    } else {
                        stress = K * Math.pow(epsilon_0 + plasticStrain, n);
                    }
                    
                    plasticX.push(totalStrain);
                    plasticY.push(stress);
                }

                // Generate linear approximation data
                const linearX = [elasticLimit, A];
                let endStress;
                if (epsilon_0 === 0) {
                    const eps_y_calc = Math.pow(E / K, 1 / (n - 1));
                    endStress = K * Math.pow(eps_y_calc + (A - elasticLimit), n);
                } else {
                    endStress = K * Math.pow(epsilon_0 + (A - elasticLimit), n);
                }
                const linearY = [sigma_y, endStress];

                // Create datasets with separate elastic and plastic curves
                const datasets = [
                    {
                        x: elasticX,
                        y: elasticY,
                        name: 'Elastic Region',
                        type: 'elastic'
                    },
                    {
                        x: plasticX,
                        y: plasticY,
                        name: "Swift's Law (Plastic)",
                        type: 'plastic'
                    },
                    {
                        x: linearX,
                        y: linearY,
                        name: 'Linear Approximation',
                        type: 'linear'
                    },
                    {
                        x: [A],
                        y: [endStress],
                        name: 'Necking',
                        type: 'necking'
                    }
                ];

                const options = {
                    title: "Swift's Law: Stress-Strain Curve",
                    xAxisTitle: 'Total Strain [-]',
                    yAxisTitle: 'True Stress [MPa]',
                    stressUnit: 'MPa'
                };

                createCustomSwiftChart('stressStrainChart', datasets, options)
                    .catch(error => {
                        console.error('Error creating Swift Law chart:', error);
                    });

            } catch (error) {
                console.error('Chart drawing error:', error);
            }
        }

        // Custom chart creation function for Swift's Law with specific styling
        function createCustomSwiftChart(containerId, datasets, options = {}) {
            const traces = datasets.map((dataset, index) => {
                const baseTrace = {
                    x: dataset.x,
                    y: dataset.y,
                    name: dataset.name,
                    hovertemplate: `<b>${dataset.name}</b><br>` +
                                  `Strain: %{x:.4f}<br>` +
                                  `Stress: %{y:.2f} ${options.stressUnit || 'MPa'}<br>` +
                                  `<extra></extra>`
                };

                // Customize trace based on type
                switch (dataset.type) {
                    case 'elastic':
                        return {
                            ...baseTrace,
                            type: 'scatter',
                            mode: 'lines',
                            line: {
                                color: '#27ae60', // Green for elastic
                                width: 3
                            }
                        };
                    case 'plastic':
                        return {
                            ...baseTrace,
                            type: 'scatter',
                            mode: 'lines',
                            line: {
                                color: '#3498db', // Blue for plastic (Swift's Law)
                                width: 3
                            }
                        };
                    case 'linear':
                        return {
                            ...baseTrace,
                            type: 'scatter',
                            mode: 'lines',
                            line: {
                                color: '#e74c3c', // Red for linear approximation
                                width: 2
                            }
                        };
                    case 'necking':
                        return {
                            ...baseTrace,
                            type: 'scatter',
                            mode: 'markers',
                            marker: {
                                color: '#000000', // Black for necking point
                                size: 10,
                                symbol: 'circle'
                            }
                        };
                    default:
                        return {
                            ...baseTrace,
                            type: 'scatter',
                            mode: 'lines',
                            line: {
                                color: chartManager.colorPalette[index % chartManager.colorPalette.length],
                                width: 2.5
                            }
                        };
                }
            });

            const layout = {
                ...chartManager.defaultLayout,
                title: {
                    text: options.title || 'Stress-Strain Curves',
                    font: {
                        size: 16,
                        color: '#2c3e50'
                    }
                },
                xaxis: {
                    ...chartManager.defaultLayout.xaxis,
                    title: {
                        text: options.xAxisTitle || 'Strain [-]',
                        font: chartManager.defaultLayout.xaxis.titlefont
                    }
                },
                yaxis: {
                    ...chartManager.defaultLayout.yaxis,
                    title: {
                        text: options.yAxisTitle || `Stress [${options.stressUnit || 'MPa'}]`,
                        font: chartManager.defaultLayout.yaxis.titlefont
                    }
                }
            };

            return Plotly.newPlot(containerId, traces, layout, chartManager.defaultConfig);
        }

        function exportToCSV() {
            if (!calculatedValues || Object.keys(calculatedValues).length === 0) {
                alert('No data available for export. Please enter valid parameters.');
                return;
            }

            const { E, sigma_y, n, K, eps_y, A, epsilon_0 } = calculatedValues;
            
            let csvContent = "Total Strain (Œµ_total),Plastic Strain (Œµ_plastic),True Stress œÉ\n";
            
            const maxStrain = A * 1.1;
            const steps = 50;
            const strainStep = maxStrain / steps;
            const elasticLimit = sigma_y / E;

            // Create array of strain values, ensuring yield point is included
            const strainValues = [];
            let yieldPointIncluded = false;
            
            for (let i = 0; i <= steps; i++) {
                const totalStrain = i * strainStep;
                
                // If we haven't included yield point yet and current strain > elasticLimit
                if (!yieldPointIncluded && totalStrain > elasticLimit) {
                    // Add yield point first
                    strainValues.push(elasticLimit);
                    yieldPointIncluded = true;
                }
                
                strainValues.push(totalStrain);
            }

            // Generate CSV rows for all strain values
            strainValues.forEach(totalStrain => {
                let plasticStrain, stress;

                if (totalStrain <= elasticLimit) {
                    plasticStrain = 0;
                    stress = E * totalStrain;
                } else {
                    plasticStrain = totalStrain - elasticLimit;
                    
                    if (epsilon_0 === 0) {
                        // Traditional Swift's law: œÉ = K(Œµ_plastic)‚Åø
                        const eps_y_calc = Math.pow(E / K, 1 / (n - 1));
                        stress = K * Math.pow(eps_y_calc + plasticStrain, n);
                    } else {
                        // Modified Swift's law: œÉ = K(Œµ‚ÇÄ + Œµ_plastic)‚Åø
                        stress = K * Math.pow(epsilon_0 + plasticStrain, n);
                    }
                }

                csvContent += totalStrain.toExponential(6) + "," + 
                             plasticStrain.toExponential(6) + "," + 
                             stress.toExponential(6) + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                
                const now = new Date();
                const timestamp = now.getFullYear() + '-' + 
                                String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                                String(now.getDate()).padStart(2, '0') + '_' + 
                                String(now.getHours()).padStart(2, '0') + '-' + 
                                String(now.getMinutes()).padStart(2, '0');
                
                link.setAttribute('download', 'swift_law_data_' + timestamp + '.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function generateDefineCurveStress() {
            try {
                const { n, K, epsilon_0 } = calculatedValues;
                
                // Format values with proper positioning (right-aligned in their columns)
                // K: positions 21-30, n: positions 31-40, eps_0: positions 41-50
                const K_str = formatScientific(K, 4);
                const n_str = formatScientific(n, 4);
                const eps0_str = formatScientific(epsilon_0, 4);
                
                // Build the line with exact positioning
                let line5 = '         1         1'; // LCID=1, ITYPE=1 (positions 1-20)
                line5 += K_str.padStart(10);        // K at positions 21-30
                line5 += n_str.padStart(10);        // n at positions 31-40
                line5 += eps0_str.padStart(10);     // eps_0 at positions 41-50
                
                const curveDefinition = `*DEFINE_CURVE_STRESS
$ ITYPE is Type of hardening law. EQ.1: Swift power law
$--------1---------2---------3---------4---------5---------6---------7---------8
$#    LCID     ITYPE      P1=K      P2=n  P3=eps_0
${line5}
$--------1---------2---------3---------4---------5---------6---------7---------8`;

                document.getElementById('defineCurveStress').textContent = curveDefinition;
            } catch (error) {
                console.error('DEFINE_CURVE_STRESS generation error:', error);
            }
        }

        function copyToClipboard() {
            const text = document.getElementById('defineCurveStress').textContent;
            navigator.clipboard.writeText(text).then(function() {
                // Visual feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copied!';
                button.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                alert('Failed to copy to clipboard. Please copy manually.');
            });
        }

        // Toggle collapsible sections
        function toggleCollapse(header) {
            const content = header.nextElementSibling;
            const isCollapsed = header.classList.contains('collapsed');
            
            if (isCollapsed) {
                // Expand
                header.classList.remove('collapsed');
                content.classList.remove('collapsed');
            } else {
                // Collapse
                header.classList.add('collapsed');
                content.classList.add('collapsed');
            }
        }

        // Units functions
        function toggleUnitsPanel() {
            const panel = document.getElementById('unitsSettings');
            panel.style.display = panel.style.display === 'none' ? 'grid' : 'none';
        }

        function updateUnits() {
            const pressureUnit = document.getElementById('pressureUnit').value;
            const strainUnit = document.getElementById('strainUnit').value;
            
            // Update unit displays
            document.getElementById('youngModulusUnit').textContent = pressureUnit;
            document.getElementById('yieldStrengthUnit').textContent = pressureUnit;
            document.getElementById('tensileStrengthUnit').textContent = pressureUnit;
            document.getElementById('trueTensileStrengthUnit').textContent = pressureUnit;
            document.getElementById('strengthCoefficientUnit').textContent = pressureUnit;
            document.getElementById('tangentModulusUnit').textContent = pressureUnit;
            
            document.getElementById('elongationUnit').textContent = strainUnit || '-';
            document.getElementById('epsilon0Unit').textContent = strainUnit || '-';
            document.getElementById('residualStrainUnit').textContent = strainUnit || '-';
            
            // Recalculate with new units
            scheduleCalculation();
        }

        // Page initialization
        window.onload = function() {
            // Initialize chart manager after all scripts are loaded
            if (typeof PlotlyChartManager !== 'undefined') {
                try {
                    chartManager = new PlotlyChartManager();
                } catch (error) {
                    console.error('Failed to initialize PlotlyChartManager:', error);
                }
            }
            calculate();
        };
    </script>
    
    <!-- Plotly.js and Chart Manager -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
    <script src="src/js/utils/PlotlyChartManager.js"></script>
    
    <!-- Navigation Script -->
    <script src="navigation.js"></script>
</body>
</html>
